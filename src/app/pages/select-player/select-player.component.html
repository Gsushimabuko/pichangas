<div class="container">
  <h1 class="title">Selecciona un Partido</h1>

  <div class="select-container">
    <select (change)="onMatchSelect($event)" class="match-select">
      <option value="">-- Selecciona un partido --</option>
      <option *ngFor="let match of matches" [value]="match.id">
        {{ match.name }} - {{ match.date | date:'dd/MM/yy' }}
      </option>
    </select>
  </div>

  <div *ngIf="selectedMatch" class="content">
    <div class="match-details">
      <h2>{{ selectedMatch.name }}</h2>
      <p><strong>Fecha y Hora:</strong> {{ selectedMatch.date | date:'medium' }}</p>
      <div class="teams">
        <div class="team">
          <h3>Equipo A</h3>
          <ul>
            <li *ngFor="let player of selectedMatch.teamA; let i = index">
              {{ player }} - {{ getPlayerAverage(selectedMatch.teamAIds[i]) }}
              <br><small>Votos realizados: {{ getVoterCount(selectedMatch.teamAIds[i]) }}</small>
            </li>
          </ul>
        </div>
        <div class="team">
          <h3>Equipo B</h3>
          <ul>
            <li *ngFor="let player of selectedMatch.teamB; let i = index">
              {{ player }} - {{ getPlayerAverage(selectedMatch.teamBIds[i]) }}
              <br><small>Votos realizados: {{ getVoterCount(selectedMatch.teamBIds[i]) }}</small>
            </li>
          </ul>
        </div>
      </div>
      <p *ngIf="selectedMatch.winner"><strong>Ganador:</strong> {{ selectedMatch.winner }}</p>
      <p *ngIf="!selectedMatch.winner"><strong>Ganador:</strong> Pendiente</p>
      <p *ngIf="mvp"><strong>MVP:</strong> {{ mvp.name }} ⭐ ({{ mvp.average.toFixed(1) }})</p>
    </div>

    <div class="vote-card">
      <h3>Votación de Jugadores</h3>
      <form (ngSubmit)="onSubmitAllVotes()" class="vote-form">
        <div class="form-group">
          <label for="voter">Tu Nombre:</label>
          <select id="voter" [(ngModel)]="selectedVoter" name="voter" required>
            <option value="">-- Selecciona tu nombre --</option>
            <option *ngFor="let player of players" [value]="player.id">{{ player.name }}</option>
          </select>
        </div>

        <div *ngIf="selectedVoter && selectedMatch" class="form-group">
          <label>Califica a los demás jugadores del partido:</label>
          <div class="players-rating-list">
            <div *ngFor="let player of getCurrentMatchPlayers()" [ngClass]="{'hidden': player.id === selectedVoter}" class="player-rating-item">
              <span>{{ player.name }}</span>
              <select [(ngModel)]="playerRatings[player.id]" [name]="'rating_' + player.id" required>
                <option value="">-- Puntaje --</option>
                <option *ngFor="let s of [1,2,3,4,5,6,7,8,9,10]" [value]="s">{{ s }}</option>
              </select>
            </div>
          </div>
        </div>

        <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
        <button type="submit" class="submit-btn" [disabled]="!selectedVoter || !allRatingsValid()">Enviar Votación</button>
      </form>
    </div>
  </div>
</div>
